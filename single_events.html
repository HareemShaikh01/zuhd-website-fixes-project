<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Single_event</title>

    <!-- Fonts & Icons -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Amiri:wght@400;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css"
    />
    <!-- Styles -->
    <link rel="stylesheet" href="styles.css" />
    <!-- GSAP core + ScrollTrigger CDN -->
    <script
      defer
      src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"
    ></script>
    <script
      defer
      src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"
    ></script>
    <!-- Your custom JS -->
    <script defer src="script.js"></script>
    <style>
      :root {
        --primary-color: #0f3d2e; /* Deep green */
        --gold: #c6a769;
        --deep-green: #0f3d2e;
        --light-gold: #e4d6b5;
        --light-bg: #f8f8f8;
      }

      body {
        font-family: "Inter", sans-serif;
        margin: 0;
        padding: 0;
        color: white;
        line-height: 1.6;
        background-color: var(--light-bg);
      }

      a {
        text-decoration: none;
        color: inherit;
      }

      /* Header Styles */
      .lectures-header {
        max-width: 800px;
      }
      .lectures-title {
        font-size: 3rem;
        margin: 24px auto;
        position: relative;
        z-index: 2;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        width: 90%;
        max-width: 1200px;
      }

      .headings {
        color: var(--deep-green);
        font-size: 2rem;
        margin-top: 80px;
      }

      /* Main Content Styles */
      .main-content {
        padding: 20px 40px;
        color: var(--deep-green);
        background-color: var(--light-bg);
      }

      .event-intro p {
        font-size: 1.3rem;
        line-height: 1.8;
        text-align: center;
        max-width: 900px;
        margin: 0 auto;
      }

      /* Image Gallery */
      .image-gallery {
        display: grid;
        grid-template-columns: 1fr; /* mobile: full width */
        gap: 30px;
        margin: 30px auto;
        justify-content: center;
      }

      /* Tablet (≥768px) → 2 columns */
      @media (min-width: 768px) {
        .image-gallery {
          grid-template-columns: repeat(2, 1fr);
        }
      }

      /* Desktop (≥1024px) → 4 columns */
      @media (min-width: 1024px) {
        .image-gallery {
          grid-template-columns: repeat(4, 1fr);
        }
      }

      .gallery-item {
        position: relative;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        transition: transform 0.3s ease, box-shadow 0.3s ease;
      }

      .gallery-item:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 16px rgba(0, 0, 0, 0.15);
      }

      .gallery-item img {
        width: 100%;
        height: 100%;
        border-radius: 18px;
        object-fit: cover;
        transition: transform 0.5s ease;
      }

      .gallery-item:hover img {
        transform: scale(1.05);
      }

      /* Carousel */
      .carousel-container {
        position: relative;
        margin: 40px auto;
        width: 70%;
        border-radius: 8px;
        overflow: hidden;
        box-shadow: 0 4px 12px var(--deep-green);
        background-color: var(--deep-green);
      }

      .carousel {
        display: flex;
        transition: transform 0.5s ease;
      }

      .carousel-item {
        min-width: 100%;
        height: 500px;
      }

      .carousel-item img {
        width: 100%;
        height: 100%;
        object-fit: contain;
        object-position: top;
      }

      .carousel-control {
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        background-color: rgba(0, 0, 0, 0.5);
        color: white;
        border: none;
        width: 40px;
        height: 40px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: background-color 0.3s ease;
        z-index: 10;
      }

      .carousel-control:hover {
        background-color: rgba(0, 0, 0, 0.8);
      }

      .carousel-control.prev {
        left: 15px;
      }

      .carousel-control.next {
        right: 15px;
      }

      .carousel-indicators {
        position: absolute;
        bottom: 15px;
        left: 50%;
        transform: translateX(-50%);
        display: flex;
        gap: 8px;
        z-index: 10;
      }

      .carousel-indicator {
        width: 12px;
        height: 12px;
        border-radius: 50%;
        background-color: rgba(255, 255, 255, 0.5);
        cursor: pointer;
        transition: background-color 0.3s ease;
      }

      .carousel-indicator.active {
        background-color: white;
      }

      /* Links Section */
      .links-section {
        margin: 30px 0;
      }

      .link-card {
        background-color: var(--light-bg);
        border-radius: 8px;
        padding: 20px;
        display: flex;
        align-items: center;
        gap: 15px;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        border: 1px solid #eaeaea;
      }

      .link-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
        border-color: var(--gold);
      }

      .link-icon {
        width: 50px;
        height: 50px;
        background-color: var(--primary-color);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 1.2rem;
        flex-shrink: 0;
      }

      .link-content {
        flex: 1;
      }

      .link-content h3 {
        margin: 0 0 5px 0;
        font-size: 1.1rem;
        color: var(--primary-color);
      }

      .link-content p {
        margin: 0;
        color: #666;
        font-size: 0.9rem;
      }

      .links-grid {
        display: grid;
        grid-template-columns: repeat(
          4,
          1fr
        ); /* always 4 equal columns on desktop */
        gap: 20px;
        justify-items: center; /* center cards inside grid cells */
      }

      @media (max-width: 1024px) {
        .links-grid {
          grid-template-columns: repeat(2, 1fr); /* 2 cards per row on tablet */
        }
      }

      @media (max-width: 640px) {
        .links-grid {
          grid-template-columns: 1fr; /* single card per row on mobile */
        }
      }

      .video-card {
        display: flex;
        flex-direction: column;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 8px;
        overflow: hidden;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        width: 320px;
        height: 100%;
      }

      .video-card:hover {
        transform: translateY(-8px);
        box-shadow: 0 12px 24px rgba(0, 0, 0, 0.15);
      }

      .thumbnail-container {
        position: relative;
        padding-top: 56.25%; /* 16:9 ratio */
        background-color: #000;
      }

      .video-thumbnail {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: opacity 0.3s ease;
      }

      .play-icon {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        color: var(--gold);
        font-size: 3.5rem;
        opacity: 0.8;
        text-shadow: 0 0 8px rgba(0, 0, 0, 0.5);
        transition: opacity 0.3s ease;
      }

      .video-card:hover .play-icon {
        opacity: 1;
      }

      .video-info {
        flex: 1 1 auto;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        padding: 16px;
      }

      .video-title {
        font-size: 1rem;
        font-weight: 600;
        margin-bottom: 12px;
        color: var(--deep-green);
        height: auto;
        display: -webkit-box;
        -webkit-box-orient: vertical;
        overflow: hidden;
        text-overflow: ellipsis;
      }

      .video-meta {
        display: flex;
        justify-content: space-between;
        color: var(--deep-green);
        font-size: 0.85rem;
        margin-top: 12px;
        padding-top: 12px;
        border-top: 1px solid var(--deep-green);
      }

      .video-meta i {
        margin-right: 6px;
      }

      /* Past Events Section */

      .section-heading {
        font-family: "Amiri", serif;
        font-size: 2.2rem;
        color: var(--primary-color);
        margin: 50px 0;
        position: relative;
        padding-bottom: 15px;
        text-align: center;
      }

      .section-heading::after {
        content: "";
        position: absolute;
        bottom: 0;
        left: 50%;
        transform: translateX(-50%);
        width: 80px;
        height: 3px;
        background-color: var(--gold);
      }

      .past-event {
        padding: 30px;
        margin-bottom: 30px;
      }

      .past-event:hover {
        transform: translateY(-5px);
      }

      .past-event-heading {
        text-align: center;
        font-family: "Amiri", serif;
        font-size: 1.8rem;
        color: var(--primary-color);
        margin-bottom: 20px;
      }

      /* Footer Styles */
      .footer {
        background-color: var(--primary-color);
        color: white;
        padding: 40px 0 20px;
      }

      .footer-content {
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 20px;
      }

      .footer-top {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 30px;
        margin-bottom: 30px;
      }

      .footer-column h3 {
        font-size: 1.2rem;
        margin-bottom: 20px;
        position: relative;
        padding-bottom: 10px;
      }

      .footer-column h3::after {
        content: "";
        position: absolute;
        bottom: 0;
        left: 0;
        width: 40px;
        height: 2px;
        background-color: var(--gold);
      }

      .footer-column ul {
        list-style: none;
        padding: 0;
        margin: 0;
      }

      .footer-column ul li {
        margin-bottom: 10px;
      }

      .footer-column ul li a {
        color: rgba(255, 255, 255, 0.8);
        transition: color 0.3s ease;
      }

      .footer-column ul li a:hover {
        color: var(--gold);
      }

      .newsletter p {
        margin-bottom: 20px;
        color: rgba(255, 255, 255, 0.8);
      }

      .newsletter-form {
        display: flex;
        margin-bottom: 20px;
      }

      .newsletter-form input {
        flex: 1;
        padding: 12px 15px;
        border: none;
        border-radius: 4px 0 0 4px;
        outline: none;
      }

      .newsletter-form button {
        padding: 12px 20px;
        background-color: var(--gold);
        color: var(--deep-green);
        border: none;
        border-radius: 0 4px 4px 0;
        cursor: pointer;
        font-weight: 600;
        transition: background-color 0.3s ease;
      }

      .newsletter-form button:hover {
        background-color: #d4b977;
      }

      .social-links {
        display: flex;
        gap: 15px;
      }

      .social-link {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 40px;
        height: 40px;
        background-color: rgba(255, 255, 255, 0.1);
        border-radius: 50%;
        transition: background-color 0.3s ease;
      }

      .social-link:hover {
        background-color: var(--gold);
        color: var(--deep-green);
      }

      .footer-bottom {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding-top: 20px;
        border-top: 1px solid rgba(255, 255, 255, 0.1);
        flex-wrap: wrap;
        gap: 15px;
      }

      .footer-links {
        display: flex;
        gap: 20px;
      }

      .footer-links a {
        color: rgba(255, 255, 255, 0.7);
        font-size: 0.9rem;
        transition: color 0.3s ease;
      }

      .footer-links a:hover {
        color: var(--gold);
      }

      @media (max-width: 768px) {
        .lectures-title {
          font-size: 2.2rem;
        }

        .content-section {
          padding: 25px;
        }

        .carousel-item {
          height: 300px;
        }

        .footer-bottom {
          flex-direction: column;
          text-align: center;
        }

        .footer-links {
          justify-content: center;
        }
      }

      @media (max-width: 480px) {
        .image-gallery {
          grid-template-columns: 1fr;
        }

        .carousel-item {
          height: 250px;
        }
      }
    </style>
  </head>
  <body>
    <nav>
      <div id="navbar"></div>
    </nav>
    <section class="banner-wrapper">
      <main class="lectures-main">
        <div class="container">
          <!-- Dynamic Header -->
          <div class="lectures-header">
            <h1 class="lectures-title" id="dynamic-title">
              ZUHD ISLAMIC LECTURES
            </h1>
            <p class="lectures-subtitle">
              Explore a collection of enlightening content to deepen your
              understanding.
            </p>
          </div>
        </div>
      </main>
    </section>

    <div class="main-content">
      <!-- Event content will be dynamically inserted here -->
    </div>

    <footer class="footer">
      <div class="footer-content">
        <div class="footer-top">
          <div class="footer-column">
            <h3>zuhd Academy</h3>
            <ul>
              <li><a href="/about-zuhd.html">About ZUHD</a></li>
              <li><a href="/zuhd-lectures.html">ZUHD Lectures</a></li>
              <li><a href="/desclimer.html">Disclaimer</a></li>
              <li>
                <a href="/after-school-classes.html">After School Classes</a>
              </li>
              <li><a href="/terms.html">Terms and conditions</a></li>
            </ul>
          </div>
          <div class="footer-column">
            <h3>Quick Links</h3>
            <ul>
              <li><a href="/store.html">zuhd Store</a></li>
              <li><a href="/donate.html">Donate Now</a></li>
              <li><a href="/ziyarat.html">Ziyarat</a></li>
            </ul>
          </div>
          <div class="footer-column">
            <h3>Contact Us</h3>
            <ul>
              <li><a href="/our-story.html">Our Story</a></li>
              <li><a href="/blog.html">Blog</a></li>
              <li><a href="/about.html">About Us</a></li>
              <li><a href="/contact.html">Contact Us</a></li>
            </ul>
          </div>
          <div class="footer-column newsletter">
            <h3>Sign Up and Save</h3>
            <p>
              Be the first to receive Islamic guidance, inspiring articles, and
              special offers.
            </p>
            <form class="newsletter-form">
              <input type="email" placeholder="Enter your email" required />
              <button type="submit">→</button>
            </form>
            <div class="social-links">
              <a
                href="https://www.facebook.com/zuhd.au"
                class="social-link"
                title="Facebook"
              >
                <i class="fab fa-facebook-f"></i>
              </a>
              <a
                href="https://www.instagram.com/zuhd_au"
                class="social-link"
                title="Instagram"
              >
                <i class="fab fa-instagram"></i>
              </a>
              <a
                href="https://www.tiktok.com/@zuhd.store"
                class="social-link"
                title="TikTok"
              >
                <i class="fab fa-tiktok"></i>
              </a>
              <a
                href="https://www.youtube.com/@zuhdau"
                class="social-link"
                title="YouTube"
              >
                <i class="fab fa-youtube"></i>
              </a>
            </div>
          </div>
        </div>
        <div class="footer-bottom">
          <div class="copyright">© 2024 Zuhd Guidance All rights reserved.</div>
          <div class="footer-links">
            <a href="#">Terms of Service</a>
            <a href="#">Privacy Policy</a>
            <a href="#">Refund Policy</a>
            <a href="#">Accessibility Policy</a>
          </div>
        </div>
      </div>
    </footer>

    <script>
      // --- YouTube API key (as provided) ---
      const API_KEY = "AIzaSyDH2HM_h4PsMZ270QUVQ5OvOPk9BsPrgbg";

      // Event data (same as your provided array)
      const eventsData = [
        {
          id: 1,
          heading: "The Ultimate Success 2025 Australian Tour",
          introduction: [
            "Before the Trumpet: A World on the Edge",
            "This national tour brings world-renowned scholars and reciters to Perth, Brisbane, Sydney, and Melbourne with one powerful mission to awaken hearts and strengthen faith. Organized by Al-Itqan Academy, the event also supports their vision of building a mosque and Quran Education Centre in Narre Warren, creating a lasting legacy for future generations.",
          ],
          images: [
            "events/al atqan academy/A3 BRISBANE.png",
            "events/al atqan academy/A3 MELBOURNE.png",
            "events/al atqan academy/A3 PERTH.png",
            "events/al atqan academy/A3 SYDNEY.png",
          ],
          carousels: [
            [
              "events/al atqan academy/brisbine/0.png",
              "events/al atqan academy/brisbine/1.jpg",
              "events/al atqan academy/brisbine/2.jpg",
              "events/al atqan academy/brisbine/3.jpg",
            ],
            [
              "events/al atqan academy/melbourne/0.png",
              "events/al atqan academy/melbourne/1.jpg",
              "events/al atqan academy/melbourne/2.jpg",
              "events/al atqan academy/melbourne/3.jpg",
            ],
            [
              "events/al atqan academy/perth/0.png",
              "events/al atqan academy/perth/1.jpg",
              "events/al atqan academy/perth/2.jpg",
              "events/al atqan academy/perth/3.jpg",
            ],
            [
              "events/al atqan academy/sydney/0.png",
              "events/al atqan academy/sydney/1.png",
              "events/al atqan academy/sydney/2.jpg",
              "events/al atqan academy/sydney/3.jpg",
            ],
          ],
          links: [
            "https://youtu.be/wnFvHMjiu_Y?si=83y1uS3mGBqYz2Ge",
            "https://youtu.be/wnFvHMjiu_Y?si=83y1uS3mGBqYz2Ge",
          ],
          pastEvents: [],
        },
        {
          id: 2,
          heading: "Palestine National Day 2025",
          introduction: [
            "Commemorated on 15 November, Palestine National Day marks the 1988 declaration of independence and stands as a symbol of resilience and hope.",
            "Celebrated at Federation Square in Melbourne, it showcases Palestinian culture through food, music, art, and storytelling. Since 2016, the event has grown into a platform of solidarity, uniting communities across Australia.",
          ],
          carousels: [
            [
              "events/palestine/image (1).png",
              "events/palestine/image.png",
              "events/palestine/img.jpeg",
            ],
          ],
          links: [],
          pastEvents: [],
        },
        {
          id: 3,
          heading: "AMCC Events",
          introduction: [
            "The Victoria Spring Festival 2025 brings people of all cultures together for three days of fun, food, and festivities in Melton.",
            "From camel rides and amusement attractions to food trucks, markets, fireworks, and live performances, there's something for everyone. Organized by AMCC, the festival celebrates diversity and community spirit with free entry for all.",
          ],
          images: [
            "events/victoria/Artboard 1.png",
            "events/victoria/Artboard 2.png",
          ],
          carousels: [],
          links: [],
          pastEvents: [
            {
              heading: "Melton Eid Fest 2025",
              introduction: [
                "The Melton Eid Fest 2025 lit up Melton with two days of joy, culture, and celebration.",
                "Families enjoyed camel rides, thrilling amusements, vibrant markets, delicious food, and cultural activities in a welcoming space. Organized by AMCC, the festival celebrated Eid as a time of togetherness and cultural pride, open to all backgrounds.",
              ],
              images: [],
              carousels: [
                [
                  "events/02 EID SHOW/melton (1).jpeg",
                  "events/02 EID SHOW/melton (2).jpeg",
                  "events/02 EID SHOW/melton (3).jpeg",
                  "events/02 EID SHOW/melton (4).jpeg",
                  "events/02 EID SHOW/melton (5).jpeg",
                ],
              ],
              links: [],
            },
          ],
        },
        {
          id: 4,
          heading: "5th Annual Seerah Conference 2025",
          introduction: [
            "The Seerah Conference brings together scholars, teachers, and community leaders to reflect on the life and legacy of the Prophet ﷺ.",
            "Hosted at the Keysborough Turkish Islamic & Cultural Centre, this year's gathering will feature renowned speakers and heartfelt discussions. Join us on 21st September to learn, connect, and be inspired while sharing in the reward of spreading the Prophet's ﷺ message.",
          ],
          images: [
            "events/annual seerah conference/5th annual serrah conference.png",
          ],
          carousels: [],
          links: [],
          pastEvents: [
            {
              heading: "Annual Seerah Conference Melbourne 2024",
              introduction: [
                "Reflecting on the 2024 Seerah Conference, this gathering brought together scholars and community members to share knowledge and inspiration.",
              ],
              images: [],
              carousels: [],
              links: ["https://www.youtube.com/watch?v=xyrkeq0Zfzc"],
            },
            {
              heading: "Annual Seerah Conference 2023",
              introduction: [
                "The 2023 edition of the Seerah Conference united the community for reflection and learning.",
              ],
              images: [],
              carousels: [],
              links: ["https://www.youtube.com/watch?v=uDcpzzIM4_c"],
            },
          ],
        },
        {
          id: 5,
          heading: "Shaykh Mufti Tauqeer 2025",
          introduction: [
            "Shaykh Mufti Tauqeer's Melbourne tour brought together families and community members for a series of uplifting sessions on Hadith, Seerah, parenting, emotional intelligence, and the future of Islam.",
            "Joined by esteemed international scholars, the program provided a transformative experience that inspired hearts, strengthened faith, and deepened the community's connection to the Deen.",
          ],
          images: [
            "events/01 Mufti Tauqeer Sahib/Mufti Tauqeer Sahib SP-02.png",
            "events/01 Mufti Tauqeer Sahib/Mufti Tauqeer Sahib SP-04.png",
            "events/01 Mufti Tauqeer Sahib/Mufti Tauqeer Sahib SP-06.png",
            "events/01 Mufti Tauqeer Sahib/Mufti Tauqeer Sahib SP-08.png",
            "events/01 Mufti Tauqeer Sahib/Mufti Tauqeer Sahib SP-10.png",
            "events/01 Mufti Tauqeer Sahib/Mufti Tauqeer Sahib SP-12.png",
            "events/01 Mufti Tauqeer Sahib/Mufti Tauqeer Sahib SP-14.png",
            "events/01 Mufti Tauqeer Sahib/Mufti Tauqeer Sahib SP-16.png",
            "events/01 Mufti Tauqeer Sahib/Mufti Tauqeer Sahib-06.png",
          ],
          carousels: [],
          links: [],
          pastEvents: [],
        },
        {
          id: 6,
          heading: "The Eid Show",
          introduction: [
            "The Eid Show is one of Australia's biggest and most successful multicultural Eid celebrations, hosted annually in Sydney and Melbourne.",
            "After a massive 2025 premier, the event continues to grow, bringing together tens of thousands of people for food, fun, and cultural connection.",
          ],
          images: [
            "events/02 EID SHOW/MELBOURINE.png",
            "events/02 EID SHOW/corousel1.jpeg",
            "events/02 EID SHOW/Artboard 2.png",
          ],
          carousels: [
            [
              "events/02 EID SHOW/corousel1 (1).jpeg",
              "events/02 EID SHOW/corousel1 (2).jpeg",
              "events/02 EID SHOW/corousel1 (3).jpeg",
              "events/02 EID SHOW/corousel1 (4).jpeg",
            ],
            [
              "events/02 EID SHOW/eid+experience (1).jpeg",
              "events/02 EID SHOW/eid+experience (2).jpeg",
              "events/02 EID SHOW/eid+experience (3).jpeg",
              "events/02 EID SHOW/eid+experience (1).png",
              "events/02 EID SHOW/eid+experience (2).png",
            ],
            [
              "events/02 EID SHOW/melbourine (1).jpeg",
              "events/02 EID SHOW/melbourine (2).jpeg",
              "events/02 EID SHOW/melbourine (3).jpeg",
              "events/02 EID SHOW/melbourine (4).jpeg",
              "events/02 EID SHOW/melbourine (5).jpeg",
            ],
            [
              "events/02 EID SHOW/melton (1).jpeg",
              "events/02 EID SHOW/melton (2).jpeg",
              "events/02 EID SHOW/melton (3).jpeg",
              "events/02 EID SHOW/melton (4).jpeg",
              "events/02 EID SHOW/melton (5).jpeg",
            ],
          ],
          links: [],
          pastEvents: [],
        },
      ];

      const titleElement = document.getElementById("dynamic-title");
      const mainContent = document.querySelector(".main-content");

      function getUrlParams() {
        const params = {};
        const queryString = window.location.search;
        const urlParams = new URLSearchParams(queryString);
        for (const [key, value] of urlParams) params[key] = value;
        return params;
      }

      // --- Helpers ---
      function extractVideoId(url) {
        try {
          // Try URL parsing first
          const u = new URL(url);
          const v = u.searchParams.get("v");
          if (v && v.length === 11) return v;
          // fallback to path-style (youtu.be/ID or /embed/ID)
          const path = u.pathname;
          const parts = path.split("/");
          const candidate = parts.pop() || parts.pop(); // last non-empty
          if (candidate && candidate.length === 11) return candidate;
        } catch (err) {
          // If url isn't fully qualified, fallback to regex
        }
        // Regex fallback
        const re = /(?:v=|\/)([A-Za-z0-9_-]{11})(?:&|$)/;
        const m = url.match(re);
        return m ? m[1] : null;
      }

      function formatViews(views) {
        const num = parseInt(views || 0, 10);
        if (isNaN(num)) return "0";
        if (num >= 1e6) return (num / 1e6).toFixed(1) + "M";
        if (num >= 1e3) return (num / 1e3).toFixed(1) + "K";
        return num.toString();
      }

      async function fetchVideoMeta(videoId) {
        try {
          const url = `https://www.googleapis.com/youtube/v3/videos?part=snippet,statistics&id=${videoId}&key=${API_KEY}`;
          const res = await fetch(url);
          const data = await res.json();
          if (!data || !data.items || data.items.length === 0) return null;
          const v = data.items[0];
          return {
            id: videoId,
            title: v.snippet.title,
            description: v.snippet.description,
            channel: v.snippet.channelTitle,
            thumbnails: v.snippet.thumbnails,
            publishedAt: v.snippet.publishedAt,
            views:
              v.statistics && v.statistics.viewCount
                ? v.statistics.viewCount
                : 0,
          };
        } catch (err) {
          console.error("fetchVideoMeta error", err);
          return null;
        }
      }

      function createImageGallery(images) {
        if (!images || images.length === 0) return "";
        return `
      <h1 class="section-heading">Event Gallery</h1>
      <div class="image-gallery">
        ${images
          .map(
            (img) =>
              `<div class="gallery-item"><img src="${img}" alt="Event image"></div>`
          )
          .join("")}
      </div>`;
      }

      function createCarousel(allCarousels) {
        if (!allCarousels || allCarousels.length === 0) return "";
        return allCarousels
          .map((carouselItems, carouselIndex) => {
            if (!carouselItems || carouselItems.length === 0) return "";
            return `
          
        <h1 class="section-heading">Event Slides ${carouselIndex + 1}</h1>
        <div class="carousel-container">
          <div class="carousel" id="eventCarousel${carouselIndex}">
            ${carouselItems
              .map(
                (item) =>
                  `<div class="carousel-item"><img src="${item}" alt="Event carousel image"></div>`
              )
              .join("")}
          </div>
          <button class="carousel-control prev" onclick="moveCarousel(-1, ${carouselIndex})"><i class="fas fa-chevron-left"></i></button>
          <button class="carousel-control next" onclick="moveCarousel(1, ${carouselIndex})"><i class="fas fa-chevron-right"></i></button>
          <div class="carousel-indicators">
            ${carouselItems
              .map(
                (_, i) =>
                  `<div class="carousel-indicator ${
                    i === 0 ? "active" : ""
                  }" onclick="showCarouselSlide(${i}, ${carouselIndex})"></div>`
              )
              .join("")}
          </div>
        </div>`;
          })
          .join("");
      }

      // Async: create links section by fetching youtube metadata
      async function createLinksSection(links) {
        if (!links || links.length === 0) return "";
        const cards = [];

        for (const link of links) {
          const videoId = extractVideoId(link);
          if (!videoId) {
            // fallback plain link card
            cards.push(`
              <a href="${link}" target="_blank" class="link-card">
                <div class="link-icon"><i class="fab fa-youtube"></i></div>
                <div class="link-content">
                  <h3>Watch on YouTube</h3>
                  <p>${link}</p>
                </div>
              </a>
            `);
            continue;
          }

          const meta = await fetchVideoMeta(videoId);
          if (!meta) {
            // fallback if fetch failed
            cards.push(`
              <a href="https://www.youtube.com/watch?v=${videoId}" target="_blank" class="link-card">
                <div class="link-icon"><i class="fab fa-youtube"></i></div>
                <div class="link-content">
                  <h3>Watch on YouTube</h3>
                  <p>https://www.youtube.com/watch?v=${videoId}</p>
                </div>
              </a>
            `);
            continue;
          }

          const thumbnail =
            (meta.thumbnails &&
              (meta.thumbnails.medium ||
                meta.thumbnails.high ||
                meta.thumbnails.default)) ||
            {};
          const thumbUrl = thumbnail.url || "";

          cards.push(`
            <a href="https://www.youtube.com/watch?v=${
              meta.id
            }" target="_blank" class="video-card" rel="noopener">
              <div class="thumbnail-container">
                <img class="video-thumbnail" src="${thumbUrl}" alt="${escapeHtml(
            meta.title
          )}">
                <div class="play-icon"><i class="fas fa-play-circle"></i></div>
              </div>
              <div class="video-info">
                <div>
                  <div class="video-title">${escapeHtml(meta.title)}</div>
                  <div style="font-size:.9rem;color:#5a5a5a;margin-top:6px;">${escapeHtml(
                    meta.channel
                  )}</div>
                </div>
                <div class="video-meta">
                  <span><i class="far fa-eye"></i> ${formatViews(
                    meta.views
                  )}</span>
                  <span><i class="far fa-calendar"></i> ${formatDate(
                    meta.publishedAt
                  )}</span>
                </div>
              </div>
            </a>
          `);
        }

        return `
      <div class="links-section">
        <h2 class="section-heading">Related Content</h2>
        <div class="links-grid">
          ${cards.join("")}
        </div>
      </div>`;
      }

      // Safely escape text for HTML insertion
      function escapeHtml(text) {
        if (!text) return "";
        return String(text)
          .replace(/&/g, "&amp;")
          .replace(/</g, "&lt;")
          .replace(/>/g, "&gt;")
          .replace(/"/g, "&quot;")
          .replace(/'/g, "&#039;");
      }

      function formatDate(iso) {
        try {
          const d = new Date(iso);
          return d.toLocaleDateString("en-US", {
            year: "numeric",
            month: "short",
            day: "numeric",
          });
        } catch (e) {
          return iso;
        }
      }

      // Past events - async to await nested link sections
      async function createPastEventsSection(pastEvents) {
        if (!pastEvents || pastEvents.length === 0) return "";
        let html = `<div class="past-events-section"><h2 class="section-heading">PAST EVENTS</h2>`;
        for (const event of pastEvents) {
          const linksHtml = await createLinksSection(event.links);
          html += `
            <div class="past-event">
              <h3 class="past-event-heading">${escapeHtml(event.heading)}</h3>
              <div class="event-intro">
                ${
                  event.introduction
                    ? event.introduction
                        .map((p) => `<p>${escapeHtml(p)}</p>`)
                        .join("")
                    : ""
                }
              </div>
              ${createImageGallery(event.images)}
              ${createCarousel(event.carousels)}
              ${linksHtml}
            </div>
          `;
        }
        html += `</div>`;
        return html;
      }

      // Carousel functionality
      const currentSlides = {};

      function moveCarousel(direction, carouselIndex) {
        const carousel = document.getElementById(
          `eventCarousel${carouselIndex}`
        );
        if (!carousel) return;
        const slides = carousel.querySelectorAll(".carousel-item");
        const indicators = carousel.parentElement.querySelectorAll(
          ".carousel-indicator"
        );

        if (!currentSlides[carouselIndex]) currentSlides[carouselIndex] = 0;
        currentSlides[carouselIndex] =
          (currentSlides[carouselIndex] + direction + slides.length) %
          slides.length;
        carousel.style.transform = `translateX(-${
          currentSlides[carouselIndex] * 100
        }%)`;
        indicators.forEach((indicator, i) => {
          indicator.classList.toggle(
            "active",
            i === currentSlides[carouselIndex]
          );
        });
      }

      function showCarouselSlide(index, carouselIndex) {
        const carousel = document.getElementById(
          `eventCarousel${carouselIndex}`
        );
        if (!carousel) return;
        const indicators = carousel.parentElement.querySelectorAll(
          ".carousel-indicator"
        );
        currentSlides[carouselIndex] = index;
        carousel.style.transform = `translateX(-${index * 100}%)`;
        indicators.forEach((indicator, i) => {
          indicator.classList.toggle("active", i === index);
        });
      }

      // --- Page renderer (async) ---
      document.addEventListener("DOMContentLoaded", async function () {
        const params = getUrlParams();
        const eventId = params.id ? parseInt(params.id) : 1;
        const event = eventsData.find((e) => e.id === eventId) || eventsData[0];

        titleElement.textContent = params.title
          ? decodeURIComponent(params.title)
          : event.heading;

        const eventIntroHTML = `
          <div class="content-section">
            <h1 class="section-heading">Introduction</h1>
            <div class="event-intro">
              ${
                event.introduction
                  ? event.introduction
                      .map((p) => `<p>${escapeHtml(p)}</p>`)
                      .join("")
                  : ""
              }
            </div>
        `;

        const galleryHTML = createImageGallery(event.images);
        const carouselHTML = createCarousel(event.carousels);
        const linksHTML = await createLinksSection(event.links);
        const pastEventsHTML = await createPastEventsSection(event.pastEvents);

        const fullHTML = `
          ${eventIntroHTML}
          ${galleryHTML}
          <br><br>
          ${carouselHTML}
          <br><br>
          ${linksHTML}
          <br><br>
          ${pastEventsHTML}
          </div>
        `;

        mainContent.innerHTML = fullHTML;

        // Newsletter form
        const newsletterForm = document.querySelector(".newsletter-form");
        if (newsletterForm) {
          newsletterForm.addEventListener("submit", function (e) {
            e.preventDefault();
            const email = this.querySelector('input[type="email"]').value;
            alert(`Thank you for subscribing with: ${email}`);
            this.reset();
          });
        }
      });
    </script>

    <script src="navbar.js"></script>
    <script src="/cacheBuster.js"></script>
  </body>
</html>
