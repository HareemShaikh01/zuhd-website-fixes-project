<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ziyarat - Sacred Journey</title>
    <!-- Preload critical resources -->
    <link rel="preload" href="styles.css" as="style" />
    <link rel="preload" href="script.js" as="script" />
    <link rel="preconnect" href="https://cdnjs.cloudflare.com" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    
    <!-- Styles -->
    <link rel="stylesheet" href="styles.css" />
    
    <!-- GSAP core + ScrollTrigger CDN -->
    <script
      defer
      src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"
    ></script>
    <script
      defer
      src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"
    ></script>
    
    <!-- Fonts & Icons -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css"
      media="print" onload="this.media='all'"
    />
    
    <style>
      body {
        font-family: "Serotiva-Light";
      }

      /* Heading and Tagline */
      .vlogs-header {
        text-align: center;
        padding: 40px 20px;
        position: relative;
        z-index: 2;
      }

      .vlogs-title {
        font-size: 2.5rem;
        color: var(--gold);
        margin-bottom: 15px;
        text-transform: uppercase;
        letter-spacing: 1px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        max-width: 100%;
      }

      .vlogs-tagline {
        font-size: 1.2rem;
        color: #fcfcfc;
        margin: 0 auto;
      }

      /* Video Grid */
      .videos-grid {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 20px;
        max-width: 1400px;
        margin: 20px auto 40px;
        padding: 0 20px;
        position: relative;
        z-index: 2;
      }

      .video-card {
        background: white;
        border-radius: 10px;
        overflow: hidden;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        cursor: pointer;
      }

      .video-card:hover {
        transform: translateY(-8px);
        box-shadow: 0 15px 30px rgba(0, 0, 0, 0.15);
      }

      .thumbnail-container {
        position: relative;
        padding-top: 56.25%;
        background-color: #000;
      }

      .video-thumbnail {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: opacity 0.3s ease;
      }

      .play-icon {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        color: white;
        font-size: 3rem;
        opacity: 0.8;
        text-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
        transition: opacity 0.3s ease;
      }

      .video-card:hover .play-icon {
        opacity: 1;
      }

      .video-info {
        padding: 15px;
      }

      .video-title {
        font-size: 1rem;
        font-weight: 600;
        margin-bottom: 10px;
        color: var(--dark-green);
        height: 40px;
        overflow: hidden;
        text-overflow: ellipsis;
        display: -webkit-box;
        -webkit-box-orient: vertical;
        -webkit-line-clamp: 2;
      }

      .video-meta {
        display: flex;
        justify-content: space-between;
        color: #777;
        font-size: 0.85rem;
        margin-top: 10px;
        padding-top: 10px;
        border-top: 1px solid #eee;
      }

      /* Loading Animation */
      .loader {
        text-align: center;
        padding: 50px 0;
        position: relative;
        z-index: 2;
      }

      .loader-spinner {
        border: 5px solid #f3f3f3;
        border-top: 5px solid var(--primary-green);
        border-radius: 50%;
        width: 50px;
        height: 50px;
        animation: spin 1s linear infinite;
        margin: 0 auto 20px;
      }

      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }

      .loading-text {
        color: red;
        font-weight: 500;
      }

      /* View All Button */
      .view-all-btn {
        display: block;
        width: max-content;
        margin: 80px auto;
        padding: 14px 35px;
        background: var(--secondary);
        color: var(--gold);
        border: 1px solid var(--gold);
        border-radius: 10px;
        font-weight: bold;
        font-size: 1.1rem;
        transition: all 0.3s ease;
        text-decoration: none;
        text-align: center;
        box-shadow: 0 4px 12px rgba(15, 61, 46, 0.2);
        cursor: pointer;
      }

      .view-all-btn:hover {
        background: var(--gold);
        color: var(--deep-green);
        transform: translateY(-4px);
        box-shadow: 0 6px 18px rgba(15, 61, 46, 0.35);
      }

      .view-all-btn:active {
        transform: translateY(0);
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      }

      /* Responsive Design */
      @media (max-width: 1024px) {
        .videos-grid {
          grid-template-columns: repeat(3, 1fr);
        }
        .vlogs-title {
          font-size: 2.5rem;
        }
      }

      @media (max-width: 768px) {
        .videos-grid {
          grid-template-columns: repeat(2, 1fr);
        }
        .vlogs-title {
          font-size: 2.5rem;
        }
        .vlogs-tagline {
          font-size: 1.2rem;
        }
        .video-title {
          font-size: 0.95rem;
          height: 2.8em;
        }
        .video-meta {
          font-size: 0.8rem;
        }
        .play-icon {
          font-size: 2.5rem;
        }
        .view-all-btn {
          padding: 10px 25px;
          margin: 40px auto;
          font-size: 0.9rem;
          max-width: 180px;
        }
      }

      @media (max-width: 480px) {
        .videos-grid {
          grid-template-columns: 1fr;
        }
        .vlogs-title {
          font-size: 2rem;
        }
        .vlogs-tagline {
          font-size: 1.1rem;
        }
        .video-title {
          font-size: 0.9rem;
          height: 2.6em;
        }
        .video-meta {
          font-size: 0.75rem;
        }
        .play-icon {
          font-size: 2rem;
        }
        .view-all-btn {
          padding: 8px 20px;
          margin: 40px auto;
          font-size: 0.85rem;
          max-width: 160px;
        }
      }
    </style>
  </head>
  <body>
    <nav>
      <div id="navbar"></div>
    </nav>
    
    <!-- Header Section -->
    <section class="banner-wrapper4">
      <div class="banner-overlay4"></div>
      <h1 class="ziyarat-title">Ziyarat</h1>
    </section>
    
    <!-- Main Title Section -->
    <div class="vlogs-header">
      <h1 class="vlogs-title">VLOGS</h1>
      <p class="vlogs-tagline">Sacred Journeys Through Makkah & Medina</p>
    </div>
    
    <div class="loader" id="loader">
      <div class="loader-spinner"></div>
      <p class="loading-text">Loading Ziyarat vlogs from YouTube...</p>
    </div>
    
    <div class="videos-grid" id="videosGrid">
      <!-- Videos will be loaded here dynamically -->
    </div>
    
    <!-- View All Button -->
    <button class="view-all-btn" onclick="viewAllClick()">View All</button>
    
    <footer class="footer">
      <div class="footer-content">
        <div class="footer-top">
          <div class="footer-column">
            <h3>zuhd Academy</h3>
            <ul>
              <li>
                <a href="/about-zuhd.html" onclick="linkClick('About ZUHD')"
                  >About ZUHD</a
                >
              </li>
              <li>
                <a
                  href="/zuhd-lectures.html"
                  onclick="linkClick('ZUHD Lectures')"
                  >ZUHD Lectures</a
                >
              </li>
              <li>
                <a href="/desclimer.html" onclick="linkClick('Disclaimer')"
                  >Disclaimer</a
                >
              </li>
              <li>
                <a
                  href="/after-school-classes.html"
                  onclick="linkClick('After School Classes')"
                  >After School Classes</a
                >
              </li>
              <li>
                <a
                  href="/terms.html"
                  onclick="linkClick('Terms and conditions')"
                  >Terms and conditions</a
                >
              </li>
            </ul>
          </div>
          <div class="footer-column">
            <h3>Quick Links</h3>
            <ul>
              <li>
                <a href="/store.html" onclick="linkClick('zuhd Store')"
                  >zuhd Store</a
                >
              </li>
              <li>
                <a href="/donate.html" onclick="linkClick('Donate Now')"
                  >Donate Now</a
                >
              </li>
              <li>
                <a href="/ziyarat.html" onclick="linkClick('Ziyarat')"
                  >Ziyarat</a
                >
              </li>
            </ul>
          </div>
          <div class="footer-column">
            <h3>Contact Us</h3>
            <ul>
              <li>
                <a href="/our-story.html" onclick="linkClick('Our Story')"
                  >Our Story</a
                >
              </li>
              <li><a href="/blog.html" onclick="linkClick('Blog')">Blog</a></li>
              <li>
                <a href="/about.html" onclick="linkClick('About Us')"
                  >About Us</a
                >
              </li>
              <li>
                <a href="/contact.html" onclick="linkClick('Contact Us')"
                  >Contact Us</a
                >
              </li>
            </ul>
          </div>
          <div class="footer-column newsletter">
            <h3>Sign Up and Save</h3>
            <p>
              Be the first to receive Islamic guidance, inspiring articles, and
              special offers—only from ZUHD.
            </p>
            <form class="newsletter-form" onsubmit="submitNewsletter(event)">
              <input type="email" placeholder="Enter your email" required />
              <button type="submit">→</button>
            </form>
            <div class="social-links">
              <a
                href="https://www.facebook.com/zuhd.au"
                class="social-link"
                onclick="socialClick('Facebook')"
                title="Facebook"
              >
                <i class="fab fa-facebook-f"></i>
              </a>
              <a
                href="https://www.instagram.com/zuhd_au"
                class="social-link"
                onclick="socialClick('Instagram')"
                title="Instagram"
              >
                <i class="fab fa-instagram"></i>
              </a>
              <a
                href="https://www.tiktok.com/@zuhd.store"
                class="social-link"
                onclick="socialClick('TikTok')"
                title="TikTok"
              >
                <i class="fab fa-tiktok"></i>
              </a>
              <a
                href="https://www.youtube.com/@zuhdau"
                class="social-link"
                onclick="socialClick('YouTube')"
                title="YouTube"
              >
                <i class="fab fa-youtube"></i>
              </a>
            </div>
          </div>
        </div>
        <div class="footer-bottom">
          <div class="copyright">© 2024 Zuhd Guidance All rights reserved.</div>
          <div class="footer-links">
            <a href="#" onclick="linkClick('Terms of Service')"
              >Terms of Service</a
            >
            <a href="#" onclick="linkClick('Privacy Policy')">Privacy Policy</a>
            <a href="#" onclick="linkClick('Refund Policy')">Refund Policy</a>
            <a href="#" onclick="linkClick('Accessibility Policy')"
              >Accessibility Policy</a
            >
          </div>
        </div>
      </div>
    </footer>
    
    <script>
      // YouTube API configuration
      const API_KEY = "AIzaSyDH2HM_h4PsMZ270QUVQ5OvOPk9BsPrgbg";
      const PLAYLIST_ID = "PLA-ylo0o2Z5lSpeLmxcIAAbexfNobXD5U";
      const MAX_RESULTS = 50;

      // DOM elements
      const videosGrid = document.getElementById("videosGrid");
      const loader = document.getElementById("loader");

      // Store videos data
      let videos = [];

      // Fetch videos from YouTube playlist with pagination and retry logic
      async function fetchVideos(pageToken = "", retries = 3) {
        try {
          const cacheBuster = Date.now();
          const response = await fetch(
            `https://www.googleapis.com/youtube/v3/playlistItems?key=${API_KEY}&playlistId=${PLAYLIST_ID}&part=snippet&maxResults=${MAX_RESULTS}&pageToken=${pageToken}&cb=${cacheBuster}`
          );
          
          if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
          
          const data = await response.json();
          const videoIds = data.items
            .map(item => item.snippet.resourceId.videoId)
            .join(",");

          // Get video details
          const videosResponse = await fetch(
            `https://www.googleapis.com/youtube/v3/videos?key=${API_KEY}&id=${videoIds}&part=snippet,statistics,contentDetails&maxResults=${MAX_RESULTS}&cb=${cacheBuster}`
          );
          
          if (!videosResponse.ok) throw new Error(`HTTP error! status: ${videosResponse.status}`);
          
          const videosData = await videosResponse.json();

          // Filter vlogs
          const newVideos = videosData.items
            .filter((video) => {
              if (video.status && (!video.status.embeddable || video.status.privacyStatus !== "public")) {
                return false;
              }
              
              const duration = video.contentDetails.duration;
              const match = duration.match(/PT(\d+H)?(\d+M)?(\d+S)?/);
              const hours = parseInt(match[1]) || 0;
              const minutes = parseInt(match[2]) || 0;
              const seconds = parseInt(match[3]) || 0;
              const isLongVideo = hours * 3600 + minutes * 60 + seconds > 30;
              
              const isVlog =
                video.snippet.title.toLowerCase().includes("vlog") ||
                video.snippet.description.toLowerCase().includes("vlog") ||
                video.snippet.title.toLowerCase().includes("vlogging") ||
                video.snippet.description.toLowerCase().includes("vlogging");
              
              return isLongVideo && isVlog;
            })
            .map((video) => ({
              id: video.id,
              title: video.snippet.title,
              description: video.snippet.description,
              thumbnail: video.snippet.thumbnails.medium.url,
              date: video.snippet.publishedAt,
              views: parseInt(video.statistics.viewCount),
            }));

          // Add new videos to the global videos array
          videos = [...videos, ...newVideos];

          // Handle pagination
          if (data.nextPageToken) {
            await fetchVideos(data.nextPageToken, retries);
          } else {
            displayVideos(videos);
            loader.style.display = "none";
          }
        } catch (error) {
          console.error("Error fetching vlogs:", error);
          if (retries > 0) {
            await new Promise(resolve => setTimeout(resolve, 2000));
            await fetchVideos(pageToken, retries - 1);
          } else {
            loader.innerHTML = '<p class="loading-text">Failed to load vlogs. Please check your API key or try again later.</p>';
          }
        }
      }

      // Display videos in the grid
      function displayVideos(videosToDisplay) {
        videosGrid.innerHTML = "";

        if (videosToDisplay.length === 0) {
          videosGrid.innerHTML = '<p class="loading-text">No vlogs found. Please ensure videos are public and contain "vlog" in the title or description.</p>';
          return;
        }

        videosToDisplay.forEach((video) => {
          const videoCard = document.createElement("div");
          videoCard.className = "video-card";
          videoCard.innerHTML = `
            <div class="thumbnail-container">
              <img src="${video.thumbnail}" alt="${video.title}" class="video-thumbnail" loading="lazy">
              <div class="play-icon">
                <i class="fas fa-play-circle"></i>
              </div>
            </div>
            <div class="video-info">
              <h3 class="video-title">${video.title}</h3>
              <div class="video-meta">
                <span><i class="far fa-eye"></i> ${formatViews(video.views)}</span>
                <span><i class="far fa-calendar"></i> ${formatDate(video.date)}</span>
              </div>
            </div>
          `;

          videoCard.addEventListener("click", () => {
            window.open(`https://www.youtube.com/watch?v=${video.id}`, "_blank");
          });

          videosGrid.appendChild(videoCard);
        });
      }

      // Format views number
      function formatViews(views) {
        if (views >= 1000000) {
          return (views / 1000000).toFixed(1) + "M";
        } else if (views >= 1000) {
          return (views / 1000).toFixed(1) + "K";
        }
        return views;
      }

      // Format date
      function formatDate(dateString) {
        const date = new Date(dateString);
        return date.toLocaleDateString("en-US", {
          year: "numeric",
          month: "short",
          day: "numeric",
        });
      }

      // View All button click handler
      function viewAllClick() {
        window.location.href = "#";
      }

      // Initialize the page
      document.addEventListener("DOMContentLoaded", () => {
        fetchVideos();
        
        // Mobile accordion functionality for footer
        const footerColumns = document.querySelectorAll(".footer-column:not(.newsletter)");
        
        footerColumns.forEach((column) => {
          const header = column.querySelector("h3");
          
          if (header) {
            header.addEventListener("click", function () {
              if (window.innerWidth <= 768) {
                column.classList.toggle("active");
              }
            });
          }
        });

        window.addEventListener("resize", function () {
          if (window.innerWidth > 768) {
            footerColumns.forEach((column) => {
              column.classList.remove("active");
            });
          }
        });
      });

      // Footer interaction functions
      function linkClick(item) {
        console.log("Link clicked:", item);
      }

      function socialClick(platform) {
        console.log("Social link clicked:", platform);
      }

      function submitNewsletter(event) {
        event.preventDefault();
        const email = event.target.querySelector('input[type="email"]').value;
        console.log("Newsletter submitted with email:", email);
        alert("Thank you for subscribing!");
        event.target.reset();
      }
    </script>
    
    <!-- Your custom JS -->
    <script defer src="script.js"></script>
    <script src="navbar.js"></script>
    <script src="/cacheBuster.js"></script>
  </body>
</html>